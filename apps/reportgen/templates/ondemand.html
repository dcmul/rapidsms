{% extends "frame.html" %}
{% block center %}

<script>
    report_data = [
        {% for rep in reports %}
        {
            "title":"{{rep.title|escapejs}}",
            "variants": 
                [{% for v in rep.variants %}
                    "{{v.0|escapejs}}"{% if not forloop.last %},{%endif%}
                {% endfor %}],
            "formats":
                [{% for f in rep.formats %}
                    "{{f|escapejs}}"{% if not forloop.last %},{%endif%}
                    {% endfor %}]
        }{% if not forloop.last %},{% endif %} 
        {% endfor %}
    ];
    time_periods = [
        {% for p in periods %}
        {
            "title": "{{ p.title|escapejs }}",
            "values": [
                {% for item in p.periods %}
                    "{{ item.title|escapejs }}"{% if not forloop.last %},{% endif %}
                {% endfor %}
            ]
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];
</script>

<form>
    <select><option>Operational</option></select>
    <select><option>Bugongi</option></select>
    <select><option>PDF</option></select>
    <select><option>Months</option></select>
    <select><option>April 2011</option></select>
    <input type="submit" value="Generate!"></input>
</form>

<p><em>Note: Only the latest 30 reports are shown.</em></p>
<table style="width:100%">
    <tr>    
        <th>&nbsp;</th>
        <th>Title</th>
        <th>Variant</th>
        <th>Time Period</th>
        <th>Status</th>
        <th>Finished at</th>
    </tr>
    {% for rep in gen %}
    <tr>
        <td>{% if rep.is_finished %}
            <a href="/static/reportgen/ondemand/{{ rep.filename }}">{{ rep.fileformat.upper }}</a>
            {% endif %}</td>
        <td>{{ rep.title }}</td>
        <td>{{ rep.variant_title|default:"--" }}</td>
        <td>{{ rep.period_title }}</td>
        <td>{{ rep.task_state_str }}
            {% if rep.is_running %}
                <strong>({{ rep.task_progress }}%)</strong>
            {% endif %}</td>
        <td>{% if rep.is_finished %}{{ rep.finished_at|date:"d-M-Y" }} at 
            {{ rep.finished_at|date:"H:i" }}{% endif %}</td>
    </tr>
    {% endfor %}
</table>
{% endblock %}
