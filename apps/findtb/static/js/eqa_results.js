/*
Used in specimen referal tracking when you register a incomming specimen.
If you set it as invalid, hide the registration form for the patient.
*/




$(document).ready(function() {

    /* Needed to check if first, second and dtu results match or not */
    var results_table =  {'1': {'1': 'Correct',
           '10_afb': 'Correct',
           '11_afb': 'Correct',
           '12_afb': 'Correct',
           '13_afb': 'Correct',
           '14_afb': 'Correct',
           '15_afb': 'Correct',
           '16_afb': 'Correct',
           '17_afb': 'Correct',
           '18_afb': 'Correct',
           '19_afb': 'Correct',
           '1_afb': 'Correct',
           '2': 'Correct',
           '2_afb': 'Correct',
           '3': 'QE',
           '3_afb': 'Correct',
           '4_afb': 'Correct',
           '5_afb': 'Correct',
           '6_afb': 'Correct',
           '7_afb': 'Correct',
           '8_afb': 'Correct',
           '9_afb': 'Correct',
           'negative': 'HPF'},
     '10_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '11_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '12_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '13_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '14_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '15_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '16_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '17_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '18_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '19_afb': {'1': 'Correct',
                '10_afb': 'Correct',
                '11_afb': 'Correct',
                '12_afb': 'Correct',
                '13_afb': 'Correct',
                '14_afb': 'Correct',
                '15_afb': 'Correct',
                '16_afb': 'Correct',
                '17_afb': 'Correct',
                '18_afb': 'Correct',
                '19_afb': 'Correct',
                '1_afb': 'Correct',
                '2': 'QE',
                '2_afb': 'Correct',
                '3': 'QE',
                '3_afb': 'Correct',
                '4_afb': 'Correct',
                '5_afb': 'Correct',
                '6_afb': 'Correct',
                '7_afb': 'Correct',
                '8_afb': 'Correct',
                '9_afb': 'Correct',
                'negative': 'LFP'},
     '1_afb': {'1': 'Correct',
               '10_afb': 'Correct',
               '11_afb': 'Correct',
               '12_afb': 'Correct',
               '13_afb': 'Correct',
               '14_afb': 'Correct',
               '15_afb': 'Correct',
               '16_afb': 'Correct',
               '17_afb': 'Correct',
               '18_afb': 'Correct',
               '19_afb': 'Correct',
               '1_afb': 'Correct',
               '2': 'QE',
               '2_afb': 'Correct',
               '3': 'QE',
               '3_afb': 'Correct',
               '4_afb': 'Correct',
               '5_afb': 'Correct',
               '6_afb': 'Correct',
               '7_afb': 'Correct',
               '8_afb': 'Correct',
               '9_afb': 'Correct',
               'negative': 'LFP'},
     '2': {'1': 'Correct',
           '10_afb': 'QE',
           '11_afb': 'QE',
           '12_afb': 'QE',
           '13_afb': 'QE',
           '14_afb': 'QE',
           '15_afb': 'QE',
           '16_afb': 'QE',
           '17_afb': 'QE',
           '18_afb': 'QE',
           '19_afb': 'QE',
           '1_afb': 'QE',
           '2': 'Correct',
           '2_afb': 'QE',
           '3': 'Correct',
           '3_afb': 'QE',
           '4_afb': 'QE',
           '5_afb': 'QE',
           '6_afb': 'QE',
           '7_afb': 'QE',
           '8_afb': 'QE',
           '9_afb': 'QE',
           'negative': 'HFP'},
     '2_afb': {'1': 'Correct',
               '10_afb': 'Correct',
               '11_afb': 'Correct',
               '12_afb': 'Correct',
               '13_afb': 'Correct',
               '14_afb': 'Correct',
               '15_afb': 'Correct',
               '16_afb': 'Correct',
               '17_afb': 'Correct',
               '18_afb': 'Correct',
               '19_afb': 'Correct',
               '1_afb': 'Correct',
               '2': 'QE',
               '2_afb': 'Correct',
               '3': 'QE',
               '3_afb': 'Correct',
               '4_afb': 'Correct',
               '5_afb': 'Correct',
               '6_afb': 'Correct',
               '7_afb': 'Correct',
               '8_afb': 'Correct',
               '9_afb': 'Correct',
               'negative': 'LFP'},
     '3': {'1': 'QE',
           '10_afb': 'QE',
           '11_afb': 'QE',
           '12_afb': 'QE',
           '13_afb': 'QE',
           '14_afb': 'QE',
           '15_afb': 'QE',
           '16_afb': 'QE',
           '17_afb': 'QE',
           '18_afb': 'QE',
           '19_afb': 'QE',
           '1_afb': 'QE',
           '2': 'Correct',
           '2_afb': 'QE',
           '3': 'Correct',
           '3_afb': 'QE',
           '4_afb': 'QE',
           '5_afb': 'QE',
           '6_afb': 'QE',
           '7_afb': 'QE',
           '8_afb': 'QE',
           '9_afb': 'QE',
           'negative': 'HFP'},
     '3_afb': {'1': 'Correct',
               '10_afb': 'Correct',
               '11_afb': 'Correct',
               '12_afb': 'Correct',
               '13_afb': 'Correct',
               '14_afb': 'Correct',
               '15_afb': 'Correct',
               '16_afb': 'Correct',
               '17_afb': 'Correct',
               '18_afb': 'Correct',
               '19_afb': 'Correct',
               '1_afb': 'Correct',
               '2': 'QE',
               '2_afb': 'Correct',
               '3': 'QE',
               '3_afb': 'Correct',
               '4_afb': 'Correct',
               '5_afb': 'Correct',
               '6_afb': 'Correct',
               '7_afb': 'Correct',
               '8_afb': 'Correct',
               '9_afb': 'Correct',
               'negative': 'LFP'},
     '4_afb': {'1': 'Correct',
               '10_afb': 'Correct',
               '11_afb': 'Correct',
               '12_afb': 'Correct',
               '13_afb': 'Correct',
               '14_afb': 'Correct',
               '15_afb': 'Correct',
               '16_afb': 'Correct',
               '17_afb': 'Correct',
               '18_afb': 'Correct',
               '19_afb': 'Correct',
               '1_afb': 'Correct',
               '2': 'QE',
               '2_afb': 'Correct',
               '3': 'QE',
               '3_afb': 'Correct',
               '4_afb': 'Correct',
               '5_afb': 'Correct',
               '6_afb': 'Correct',
               '7_afb': 'Correct',
               '8_afb': 'Correct',
               '9_afb': 'Correct',
               'negative': 'LFP'},
     '5_afb': {'1': 'Correct',
               '10_afb': 'Correct',
               '11_afb': 'Correct',
               '12_afb': 'Correct',
               '13_afb': 'Correct',
               '14_afb': 'Correct',
               '15_afb': 'Correct',
               '16_afb': 'Correct',
               '17_afb': 'Correct',
               '18_afb': 'Correct',
               '19_afb': 'Correct',
               '1_afb': 'Correct',
               '2': 'QE',
               '2_afb': 'Correct',
               '3': 'QE',
               '3_afb': 'Correct',
               '4_afb': 'Correct',
               '5_afb': 'Correct',
               '6_afb': 'Correct',
               '7_afb': 'Correct',
               '8_afb': 'Correct',
               '9_afb': 'Correct',
               'negative': 'LFP'},
     '6_afb': {'1': 'Correct',
               '10_afb': 'Correct',
               '11_afb': 'Correct',
               '12_afb': 'Correct',
               '13_afb': 'Correct',
               '14_afb': 'Correct',
               '15_afb': 'Correct',
               '16_afb': 'Correct',
               '17_afb': 'Correct',
               '18_afb': 'Correct',
               '19_afb': 'Correct',
               '1_afb': 'Correct',
               '2': 'QE',
               '2_afb': 'Correct',
               '3': 'QE',
               '3_afb': 'Correct',
               '4_afb': 'Correct',
               '5_afb': 'Correct',
               '6_afb': 'Correct',
               '7_afb': 'Correct',
               '8_afb': 'Correct',
               '9_afb': 'Correct',
               'negative': 'LFP'},
     '7_afb': {'1': 'Correct',
               '10_afb': 'Correct',
               '11_afb': 'Correct',
               '12_afb': 'Correct',
               '13_afb': 'Correct',
               '14_afb': 'Correct',
               '15_afb': 'Correct',
               '16_afb': 'Correct',
               '17_afb': 'Correct',
               '18_afb': 'Correct',
               '19_afb': 'Correct',
               '1_afb': 'Correct',
               '2': 'QE',
               '2_afb': 'Correct',
               '3': 'QE',
               '3_afb': 'Correct',
               '4_afb': 'Correct',
               '5_afb': 'Correct',
               '6_afb': 'Correct',
               '7_afb': 'Correct',
               '8_afb': 'Correct',
               '9_afb': 'Correct',
               'negative': 'LFP'},
     '8_afb': {'1': 'Correct',
               '10_afb': 'Correct',
               '11_afb': 'Correct',
               '12_afb': 'Correct',
               '13_afb': 'Correct',
               '14_afb': 'Correct',
               '15_afb': 'Correct',
               '16_afb': 'Correct',
               '17_afb': 'Correct',
               '18_afb': 'Correct',
               '19_afb': 'Correct',
               '1_afb': 'Correct',
               '2': 'QE',
               '2_afb': 'Correct',
               '3': 'QE',
               '3_afb': 'Correct',
               '4_afb': 'Correct',
               '5_afb': 'Correct',
               '6_afb': 'Correct',
               '7_afb': 'Correct',
               '8_afb': 'Correct',
               '9_afb': 'Correct',
               'negative': 'LFP'},
     '9_afb': {'1': 'Correct',
               '10_afb': 'Correct',
               '11_afb': 'Correct',
               '12_afb': 'Correct',
               '13_afb': 'Correct',
               '14_afb': 'Correct',
               '15_afb': 'Correct',
               '16_afb': 'Correct',
               '17_afb': 'Correct',
               '18_afb': 'Correct',
               '19_afb': 'Correct',
               '1_afb': 'Correct',
               '2': 'QE',
               '2_afb': 'Correct',
               '3': 'QE',
               '3_afb': 'Correct',
               '4_afb': 'Correct',
               '5_afb': 'Correct',
               '6_afb': 'Correct',
               '7_afb': 'Correct',
               '8_afb': 'Correct',
               '9_afb': 'Correct',
               'negative': 'LFP'},
     'negative': {'1': 'HFN',
                  '10_afb': 'LFN',
                  '11_afb': 'LFN',
                  '12_afb': 'LFN',
                  '13_afb': 'LFN',
                  '14_afb': 'LFN',
                  '15_afb': 'LFN',
                  '16_afb': 'LFN',
                  '17_afb': 'LFN',
                  '18_afb': 'LFN',
                  '19_afb': 'LFN',
                  '1_afb': 'LFN',
                  '2': 'HFN',
                  '2_afb': 'LFN',
                  '3': 'HFN',
                  '3_afb': 'LFN',
                  '4_afb': 'LFN',
                  '5_afb': 'LFN',
                  '6_afb': 'LFN',
                  '7_afb': 'LFN',
                  '8_afb': 'LFN',
                  '9_afb': 'LFN',
                  'negative': 'Correct'}}


    /* check if dtu and first ctrl result match, and hide second ctrl if so */
    function update_result_match(event) {

        console.log("update_result_match")
        $("tr").slice(start=1).each(
        
          function() {
          
              $this = $(this);
               
               dtu_result = $this.find('select').eq(0).val();
               first_ctrl_result = $this.find('select').eq(1).val();
               var field = $this.find('select').eq(2);
               
               if (!results_table[dtu_result] || results_table[dtu_result][first_ctrl_result] == 'Correct')
               {
                    console.log("hidding")
                    field.css('visibility', 'hidden' );
               }
               else 
               {
                    console.log("showing")
                    field.css('visibility', 'visible' );
               }
               
          }
        );
    }

    /* For each row, if a checkbox 'cancelled' is checked, disable fields in the row */
    function update_cancelled_item_disabling() {

        $("input[type=checkbox]:checked").each(
              function() {

                  $this = $(this);
                  $this.parent('td').siblings('td').children()
                       .attr('disabled', 'disabled' );
              }
            );
    }


    
   var cancel_checkbox_handler = function(event) {
        
        $("input[type=checkbox]").each(
          function() {

              $this = $(this);
              $this.parent('td').siblings('td').children()
                   .removeAttr('disabled', 'disabled' )
                   .css('visibility', 'visible' );
        });
    
        update_result_match()
        update_cancelled_item_disabling()
        
    }
    
    /* To prevent the server side form from refusing the form, remove all disabling
    before submission */
    $("#results-form").submit(function() {
    
        $("input").removeAttr('disabled');
        $("select").removeAttr('disabled');
      
    });

    
    $("#results-form input:checkbox").change(cancel_checkbox_handler).keypress(cancel_checkbox_handler);
    $("#results-form select").change(update_result_match).keypress(update_result_match);
    update_result_match()
    update_cancelled_item_disabling()
    

   
});

