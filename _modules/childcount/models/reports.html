

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>childcount.models.reports &mdash; ChildCount+ v2.0(g) documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.0(g)',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="ChildCount+ v2.0(g) documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ChildCount+ v2.0(g) documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for childcount.models.reports</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># vim: ai ts=4 sts=4 et sw=4 coding=utf-8</span>
<span class="c"># maintainer: dgelvin, ukanga</span>

<span class="sd">&quot;&quot;&quot;ChildCount Reports&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>

<span class="kn">from</span> <span class="nn">celery.decorators</span> <span class="kn">import</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">celery.registry</span> <span class="kn">import</span> <span class="n">tasks</span>
<span class="kn">from</span> <span class="nn">celery.task.control</span> <span class="kn">import</span> <span class="n">revoke</span>

<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span>
<span class="kn">from</span> <span class="nn">django.db.models.query</span> <span class="kn">import</span> <span class="n">QuerySet</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">ugettext</span> <span class="k">as</span> <span class="n">_</span>
<span class="kn">import</span> <span class="nn">reversion</span>
<span class="kn">from</span> <span class="nn">reversion.models</span> <span class="kn">import</span> <span class="n">Version</span>

<span class="kn">from</span> <span class="nn">polymorphic</span> <span class="kn">import</span> <span class="n">PolymorphicModel</span><span class="p">,</span> <span class="n">PolymorphicManager</span>
<span class="kn">from</span> <span class="nn">polymorphic</span> <span class="kn">import</span> <span class="n">PolymorphicQuerySet</span>

<span class="kn">from</span> <span class="nn">mgvmrs.forms</span> <span class="kn">import</span> <span class="n">OpenMRSHouseholdForm</span><span class="p">,</span> <span class="n">OpenMRSConsultationForm</span>

<span class="kn">from</span> <span class="nn">alerts.utils</span> <span class="kn">import</span> <span class="n">SmsAlert</span>
<span class="kn">from</span> <span class="nn">alerts.models</span> <span class="kn">import</span> <span class="n">SmsAlertModel</span>

<span class="kn">from</span> <span class="nn">childcount.models</span> <span class="kn">import</span> <span class="n">Patient</span>
<span class="kn">from</span> <span class="nn">childcount.models</span> <span class="kn">import</span> <span class="n">Encounter</span>
<span class="kn">from</span> <span class="nn">childcount.models</span> <span class="kn">import</span> <span class="n">Vaccine</span>

<span class="kn">from</span> <span class="nn">childcount.utils</span> <span class="kn">import</span> <span class="n">send_msg</span>

<div class="viewcode-block" id="AgeQuerySet"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.AgeQuerySet">[docs]</a><span class="k">class</span> <span class="nc">AgeQuerySet</span><span class="p">(</span><span class="n">PolymorphicQuerySet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For filtering on age at time of encounter</span>
<span class="sd">    </span>
<span class="sd">    This custom SQL allows us easily to filter to find</span>
<span class="sd">    CCReports that were recorded when the patient was between</span>
<span class="sd">    START and END days old (inclusive).</span>

<span class="sd">    The Django way to do this would be to use and :class:`django.db.models.F()` + </span>
<span class="sd">    :class:`datetime.timedelta()`</span>
<span class="sd">    in a :meth:`.filter()` call, but that operation isn&#39;t supported in</span>
<span class="sd">    Django 1.1.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AgeQuerySet.encounter_under_five"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.AgeQuerySet.encounter_under_five">[docs]</a>    <span class="k">def</span> <span class="nf">encounter_under_five</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Anyone under 365*5 days old at time of encounter&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter_age</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">365.25</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
   </div>
<div class="viewcode-block" id="AgeQuerySet.encounter_over_five"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.AgeQuerySet.encounter_over_five">[docs]</a>    <span class="k">def</span> <span class="nf">encounter_over_five</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;We take anyone between five and 200 years old to be</span>
<span class="sd">        &quot;over five&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter_age</span><span class="p">((</span><span class="mf">365.25</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">365.25</span><span class="o">*</span><span class="mi">200</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="AgeQuerySet.encounter_muac_eligible"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.AgeQuerySet.encounter_muac_eligible">[docs]</a>    <span class="k">def</span> <span class="nf">encounter_muac_eligible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;MUAC eligible kids are 6 months - 5 years old&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter_age</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mf">365.25</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
   </div>
    <span class="k">def</span> <span class="nf">_encounter_filter_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Helper function for filtering the CCReport QuerySet</span>
<span class="sd">        by a custom SQL call on Encounters.</span>

<span class="sd">        query - An SQL query string containing %(pks_str)s </span>
<span class="sd">                into which the list of the input QuerySet&#39;s</span>
<span class="sd">                encounter primary keys will be inserted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="c"># Get distinct encounters</span>
        <span class="n">encs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;encounter__pk&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>

        <span class="c"># Turn them into a list of pk strings</span>
        <span class="n">pks_encounter</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">encs</span><span class="p">]</span>

        <span class="c"># Join into a comma-separated string</span>
        <span class="n">pks_str</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pks_encounter</span><span class="p">)</span>

        <span class="c"># Run query</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;pks_str&#39;</span><span class="p">:</span> <span class="n">pks_str</span><span class="p">})</span>

        <span class="c"># Convert back into a list of pks</span>
        <span class="n">pks</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>

        <span class="c"># Return the input QuerySet filtered by relevant encounter</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">encounter__pk__in</span><span class="o">=</span><span class="n">pks</span><span class="p">)</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This version of encounter_age is cleaner code-wise but</span>
<span class="sd">    runs 10-20 times slower than the pure SQL version below.</span>

<span class="sd">    def encounter_age(self, min_days, max_days):</span>
<span class="sd">        # Make sure we have a float</span>
<span class="sd">        min_days = float(min_days)</span>
<span class="sd">        max_days = float(max_days)</span>

<span class="sd">        return self\</span>
<span class="sd">            .filter(encounter__encounter_date__isnull=False,\</span>
<span class="sd">                encounter__patient__dob__isnull=False)\</span>
<span class="sd">            .extra(where=[&quot;DATEDIFF(`cc_encounter`.`encounter_date`, `cc_patient`.`dob`) BETWEEN %s AND %s&quot;],\</span>
<span class="sd">                    params=[min_days, max_days])</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AgeQuerySet.encounter_age"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.AgeQuerySet.encounter_age">[docs]</a>    <span class="k">def</span> <span class="nf">encounter_age</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_days</span><span class="p">,</span> <span class="n">max_days</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Anyone who is between `min_days` and `max_days`</span>
<span class="sd">        old (inclusive)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">q</span> <span class="o">=</span> \
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        SELECT  `cc_encounter`.`id`</span>
<span class="sd">        FROM    `cc_encounter`</span>

<span class="sd">        LEFT JOIN `cc_patient` ON </span>
<span class="sd">            (`cc_encounter`.`patient_id`=`cc_patient`.`id`)</span>

<span class="sd">        WHERE</span>
<span class="sd">            DATEDIFF(`cc_encounter`.`encounter_date`, `cc_patient`.`dob`)</span>
<span class="sd">                BETWEEN &quot;%(min_days)d&quot; AND &quot;%(max_days)d&quot; AND</span>
<span class="sd">             `cc_encounter`.`id` IN (%(pks_str)s);</span>
<span class="sd">        &#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;min_days&#39;</span><span class="p">:</span> <span class="n">min_days</span><span class="p">,</span> 
                <span class="s">&#39;max_days&#39;</span><span class="p">:</span> <span class="n">max_days</span><span class="p">,</span>
                <span class="s">&#39;pks_str&#39;</span><span class="p">:</span> <span class="s">&quot;</span><span class="si">%(pks_str)s</span><span class="s">&quot;</span><span class="p">}</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encounter_filter_sql</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="AgeQuerySet.latest_for_patient"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.AgeQuerySet.latest_for_patient">[docs]</a>    <span class="k">def</span> <span class="nf">latest_for_patient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;:meth:`latest_for_patient` filters the :class:`CCReport` QuerySet</span>
<span class="sd">        and returns only :class:`CCReport` objects that are the latest such</span>
<span class="sd">        report for each patient.</span>

<span class="sd">        For example, if you had a QuerySet of :class:`HouseholdVisitReport`</span>
<span class="sd">        objects, :meth:`latest_for_patient` would give you the most</span>
<span class="sd">        recent :class:`HouseholdVisitReport` for each household.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">q</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        SELECT `cc_encounter`.`id`</span>

<span class="s">        FROM `cc_encounter`</span>

<span class="s">        LEFT JOIN `cc_encounter` AS `cc_encounter2`</span>
<span class="s">            ON (`cc_encounter`.`patient_id` = `cc_encounter2`.`patient_id` AND</span>
<span class="s">                `cc_encounter`.`encounter_date` &lt; `cc_encounter2`.`encounter_date` AND</span>
<span class="s">                `cc_encounter2`.`id` IN (</span><span class="si">%(pks_str)s</span><span class="s">))</span>

<span class="s">        WHERE </span>
<span class="s">            `cc_encounter`.`id` IN (</span><span class="si">%(pks_str)s</span><span class="s">) AND</span>
<span class="s">            `cc_encounter2`.`id` IS NULL</span>

<span class="s">        GROUP BY</span>
<span class="s">            `cc_encounter`.`patient_id`</span>
<span class="s">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encounter_filter_sql</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    </div>
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define a hash function that depends only on the pks of the</span>
<span class="sd">        rows in the QuerySet</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s">&#39;pk&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s">&#39;pk&#39;</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="CCReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.CCReport">[docs]</a><span class="k">class</span> <span class="nc">CCReport</span><span class="p">(</span><span class="n">PolymorphicModel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The highest level superclass to be </span>
<span class="sd">    inhereted by all other report classes</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">PolymorphicManager</span><span class="p">(</span><span class="n">AgeQuerySet</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_ccrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;ChildCount Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;ChildCount Reports&quot;</span><span class="p">)</span>
        <span class="n">get_latest_by</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;encounter__encounter_date&#39;</span><span class="p">)</span>

    <span class="n">encounter</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Encounter</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Encounter&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="CCReport.substantively_equal"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.CCReport.substantively_equal">[docs]</a>    <span class="k">def</span> <span class="nf">substantively_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Two :class:`childcount.models.reports.CCReport` objects are of the same</span>
<span class="sd">        type and have all fields equal (except for their</span>
<span class="sd">        `id`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;ccreport_ptr&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="n">v1</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v1</span> <span class="o">!=</span> <span class="n">v2</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="CCReport.reset"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.CCReport.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Zero out the report&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">encounter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">patient</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">patient</span>

    <span class="k">def</span> <span class="nf">chw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">chw</span>

    <span class="k">def</span> <span class="nf">initial_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Version</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">current_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Version</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span>\
                                      <span class="n">order_by</span><span class="p">(</span><span class="s">&#39;-revision__date_created&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">entered_by</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_version</span><span class="p">()</span><span class="o">.</span><span class="n">revision</span><span class="o">.</span><span class="n">user</span>

    <span class="k">def</span> <span class="nf">entered_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_version</span><span class="p">()</span><span class="o">.</span><span class="n">revision</span><span class="o">.</span><span class="n">date_created</span>

    <span class="k">def</span> <span class="nf">modified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Version</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_object</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">modified_by</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="p">()</span><span class="o">.</span><span class="n">revision</span><span class="o">.</span><span class="n">user</span>

    <span class="k">def</span> <span class="nf">modified_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">modified</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_version</span><span class="p">()</span><span class="o">.</span><span class="n">revision</span><span class="o">.</span><span class="n">date_created</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot; - </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">string</span>

<div class="viewcode-block" id="CCReport.get_omrs_dict"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.CCReport.get_omrs_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;OpenMRS Key/Value dict.</span>

<span class="sd">        Return key/value dictionary of openmrs values that this report can</span>
<span class="sd">        populate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{}</span>
</div>
    <span class="k">def</span> <span class="nf">identity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">chw</span><span class="p">()</span><span class="o">.</span><span class="n">connection</span><span class="p">()</span><span class="o">.</span><span class="n">identity</span>
</div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">CCReport</span><span class="p">)</span>


<div class="viewcode-block" id="BirthReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.BirthReport">[docs]</a><span class="k">class</span> <span class="nc">BirthReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Birth Report&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_birthrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Birth Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Birth Reports&quot;</span><span class="p">)</span>

    <span class="n">CLINIC_DELIVERY_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">CLINIC_DELIVERY_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">CLINIC_DELIVERY_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">CLINIC_DELIVERY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">CLINIC_DELIVERY_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Yes&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">CLINIC_DELIVERY_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">CLINIC_DELIVERY_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unknown&quot;</span><span class="p">)))</span>
    <span class="sd">&quot;&quot;&quot;Whether or not the baby was delivered in a clinic&quot;&quot;&quot;</span>

    <span class="n">clinic_delivery</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Clinic delivery&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                                       <span class="n">choices</span><span class="o">=</span><span class="n">CLINIC_DELIVERY_CHOICES</span><span class="p">,</span> \
                                       <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Was the baby born in &quot;</span> \
                                                    <span class="s">&quot;a health facility?&quot;</span><span class="p">))</span>

    <span class="n">weight</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Birth weight (kg)&quot;</span><span class="p">),</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;clinic_delivery&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">get_clinic_delivery_display</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;, </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;weight&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">igive</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">:</span>
            <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;weight&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">igive</span>

    <span class="nd">@task</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">initial_neonatal_visit_reminder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Six days after a birth report remind the CHW to do an initial neonatal</span>
<span class="sd">        visit if it has not been done yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="n">BirthReport</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BirthReport</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="n">NeonatalReport</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>\
                                <span class="n">encounter__patient</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">patient</span><span class="p">)</span>
            <span class="n">nr_msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;+N&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nr</span><span class="p">:</span>
                <span class="n">nr_msg</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>
            <span class="n">ur</span> <span class="o">=</span> <span class="n">UnderOneReport</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>\
                                <span class="n">encounter__patient</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">patient</span><span class="p">)</span>
            <span class="n">ur_msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;+T&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ur</span><span class="p">:</span>
                <span class="n">ur_msg</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">ur</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">nr</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Please make sure </span><span class="si">%(child)s</span><span class="s"> gets their Initial&quot;</span>\
                        <span class="s">&quot; Neonatal Visit [</span><span class="si">%(forms)s</span><span class="s">]&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
                        <span class="s">&#39;child&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">patient</span><span class="p">,</span>
                        <span class="s">&#39;forms&#39;</span><span class="p">:</span> <span class="s">&#39; &#39;</span> <span class="o">.</span> <span class="n">join</span><span class="p">([</span><span class="n">nr_msg</span><span class="p">,</span> <span class="n">ur_msg</span><span class="p">])}</span>
                <span class="n">alert</span> <span class="o">=</span> <span class="n">SmsAlert</span><span class="p">(</span><span class="n">reporter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">patient</span><span class="o">.</span><span class="n">chw</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">sms_alert</span> <span class="o">=</span> <span class="n">alert</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
                <span class="n">sms_alert</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">u&quot;initial_neonatal_visits_6&quot;</span>
                <span class="n">sms_alert</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">initial_neonatal_visit_reminder</span><span class="p">)</span>

<div class="viewcode-block" id="BirthReport.setup_reminders"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.BirthReport.setup_reminders">[docs]</a>    <span class="k">def</span> <span class="nf">setup_reminders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Setup reminders for neonatal visit</span>
<span class="sd">            - immediate</span>
<span class="sd">            - 6 days later</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">#immediate reminder</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Please make sure </span><span class="si">%(child)s</span><span class="s"> gets their initial neonatal&quot;</span> \
                <span class="s">&quot; visit [+N and +T]&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s">&#39;child&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">patient</span><span class="p">}</span>
        <span class="n">immediate_alert</span> <span class="o">=</span> <span class="n">SmsAlert</span><span class="p">(</span><span class="n">reporter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">patient</span><span class="o">.</span><span class="n">chw</span><span class="p">,</span> \
                            <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">sms_alert</span> <span class="o">=</span> <span class="n">immediate_alert</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">send_at</span><span class="o">=</span><span class="n">delay</span><span class="p">)</span>
        <span class="n">sms_alert</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">u&quot;initial_neonatal_visits&quot;</span>
        <span class="n">sms_alert</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c">#six days later check if neonatal visit occured</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_neonatal_visit_reminder</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">eta</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> \
                                                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="p">,))</span></div></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">BirthReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="DeathReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.DeathReport">[docs]</a><span class="k">class</span> <span class="nc">DeathReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Death Report&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_deathrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Death Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Death Reports&quot;</span><span class="p">)</span>

    <span class="n">death_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Date of death&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;death_date&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">death_date</span><span class="p">)</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">DeathReport</span><span class="p">)</span>


<div class="viewcode-block" id="StillbirthMiscarriageReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.StillbirthMiscarriageReport">[docs]</a><span class="k">class</span> <span class="nc">StillbirthMiscarriageReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Stillbirth/Miscarriage Report&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_sbmcrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Stillbirth / Miscarriage Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Stillbirth / Miscarriage Reports&quot;</span><span class="p">)</span>

    <span class="n">TYPE_STILL_BIRTH</span> <span class="o">=</span> <span class="s">&#39;S&#39;</span>
    <span class="n">TYPE_MISCARRIAGE</span> <span class="o">=</span> <span class="s">&#39;M&#39;</span>
    <span class="n">TYPE_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
                       <span class="p">(</span><span class="n">TYPE_STILL_BIRTH</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Still birth&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">TYPE_MISCARRIAGE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Miscarriage&#39;</span><span class="p">)))</span>

    <span class="n">incident_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Date of stillbirth or miscarriage&quot;</span><span class="p">))</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Type&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">TYPE_CHOICES</span><span class="p">,</span> \
                            <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Still birth or miscarriage&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_type_display</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;</span><span class="si">%(type)s</span><span class="s"> on </span><span class="si">%(date)s</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">%</span> \
             <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span> <span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">incident_date</span><span class="p">}</span>

    <span class="nd">@task</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">chw_followup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        One week after still birth remindd the chw to follow on the mother.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="n">StillbirthMiscarriageReport</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">StillbirthMiscarriageReport</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">condition</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_CHOICES</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">:</span>
                    <span class="n">condition</span> <span class="o">=</span> <span class="n">y</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Please do a followup on </span><span class="si">%(mother)s</span><span class="s"> following her&quot;</span> \
                    <span class="s">&quot; </span><span class="si">%(condition)s</span><span class="s"> a week ago. We would expect a +U&quot;</span> \
                    <span class="s">&quot; report.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
                    <span class="s">&#39;mother&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">patient</span><span class="p">,</span>
                    <span class="s">&#39;condition&#39;</span><span class="p">:</span> <span class="n">condition</span><span class="p">}</span>
            <span class="n">alert</span> <span class="o">=</span> <span class="n">SmsAlert</span><span class="p">(</span><span class="n">reporter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">chw</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">sms_alert</span> <span class="o">=</span> <span class="n">alert</span><span class="o">.</span><span class="n">send</span><span class="p">()</span>
            <span class="n">sms_alert</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">u&quot;stillbirthmiscarriage_followup&quot;</span>
            <span class="n">sms_alert</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">chw_followup</span><span class="p">)</span>

<div class="viewcode-block" id="StillbirthMiscarriageReport.setup_reminders"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.StillbirthMiscarriageReport.setup_reminders">[docs]</a>    <span class="k">def</span> <span class="nf">setup_reminders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Setup alert/reminder to CHW one week after the event</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c">#One week later CHW to followup on the mother</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="c">#7am</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">delay</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">time</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chw_followup</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">eta</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> \
                                                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="p">,))</span></div></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">StillbirthMiscarriageReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="FollowUpReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.FollowUpReport">[docs]</a><span class="k">class</span> <span class="nc">FollowUpReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Follow-Up Report&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_furpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Follow-up Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Follow-up Reports&quot;</span><span class="p">)</span>

    <span class="n">IMPROVEMENT_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">IMPROVEMENT_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">IMPROVEMENT_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">IMPROVEMENT_UNAVAILABLE</span> <span class="o">=</span> <span class="s">&#39;L&#39;</span>
    <span class="n">IMPROVEMENT_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
                       <span class="p">(</span><span class="n">IMPROVEMENT_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Yes&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">IMPROVEMENT_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;No&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">IMPROVEMENT_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Unkown&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">IMPROVEMENT_UNAVAILABLE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Patient unavailable&#39;</span><span class="p">)))</span>

    <span class="n">VISITED_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">VISITED_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">VISITED_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">VISITED_INPATIENT</span> <span class="o">=</span> <span class="s">&#39;P&#39;</span>
    <span class="n">VISITED_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
                       <span class="p">(</span><span class="n">VISITED_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Yes&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">VISITED_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;No&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">VISITED_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Unkown&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">VISITED_INPATIENT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Patient currently inpatient&#39;</span><span class="p">)))</span>

    <span class="n">improvement</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Improvement&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                                   <span class="n">choices</span><span class="o">=</span><span class="n">IMPROVEMENT_CHOICES</span><span class="p">,</span> \
                              <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Has the patient&#39;s condition &quot;</span> \
                                           <span class="s">&quot;improved since the last &quot;</span> \
                                           <span class="s">&quot;CHW visit?&quot;</span><span class="p">))</span>

    <span class="n">visited_clinic</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Visited clinic&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                                   <span class="n">choices</span><span class="o">=</span><span class="n">VISITED_CHOICES</span><span class="p">,</span> \
                              <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Did the patient visit a health &quot;</span>\
                                           <span class="s">&quot;facility since the last &quot;</span> \
                                           <span class="s">&quot;CHW visit?&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;improvement&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">get_improvement_display</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;visited_clinic&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">get_visited_clinic_display</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">improv_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IMPROVEMENT_YES</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">YES</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IMPROVEMENT_NO</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">NO</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IMPROVEMENT_UNKNOWN</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IMPROVEMENT_UNAVAILABLE</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">UNAVAILABLE</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">visit_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VISITED_YES</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">YES</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VISITED_NO</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">NO</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VISITED_UNKNOWN</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">VISITED_INPATIENT</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">INPATIENT</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">igive</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;patients_condition_improved&#39;</span><span class="p">:</span> <span class="n">improv_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">improvement</span><span class="p">],</span>
            <span class="s">&#39;visit_to_health_facility_since_last_home_visit&#39;</span><span class="p">:</span> \
                                                <span class="n">visit_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visited_clinic</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">igive</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">FollowUpReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="DangerSignsReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.DangerSignsReport">[docs]</a><span class="k">class</span> <span class="nc">DangerSignsReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_dsrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Danger Signs Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Danger Signs Reports&quot;</span><span class="p">)</span>

    <span class="n">danger_signs</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s">&#39;CodedItem&#39;</span><span class="p">,</span> \
                                          <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Danger Signs&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;danger_signs&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="s">u&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ds</span><span class="o">.</span><span class="n">description</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">danger_signs</span><span class="o">.</span><span class="n">all</span><span class="p">()]))</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">igive</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">danger_signs</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;danger_signs_present&#39;</span><span class="p">:</span> \
                                <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">YES</span><span class="p">})</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__regimen_failure&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;AS&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__physical_trauma&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;BM&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__no_fetal_movements&#39;</span><span class="p">:</span> \
                                <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;BV&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__blurred_vision&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;CC&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__cough&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;CV&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__convulsions&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;CW&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__cough_lasting_more&#39;</span>\
                                <span class="s">&#39;_than_3_weeks&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;DR&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__diarrhea&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;FP&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__fever_in_first_&#39;</span>\
                                <span class="s">&#39;trimester_of_pregnancy&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;NB&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__night_blindness&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;OD&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;oedema&#39;</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">YES</span><span class="p">})</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__oedema&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PA&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__abdominal_pain&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PH&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__severe_headache&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PU&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__dysuria&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;SF&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__dermatitis&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;SW&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__peripheral_edema&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;VB&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__abnormal_vaginal_&#39;</span>\
                                <span class="s">&#39;bleeding&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;VD&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__vaginal_discharge&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;VP&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__acute_vaginitis&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;WL&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__weight_loss&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;NF&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__unable_to_drink&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Z&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__other_non_coded&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">igive</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">DangerSignsReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="PregnancyReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.PregnancyReport">[docs]</a><span class="k">class</span> <span class="nc">PregnancyReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_pregrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Pregnancy Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Pregnancy Reports&quot;</span><span class="p">)</span>

    <span class="n">pregnancy_month</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Months Pregnant&quot;</span><span class="p">),</span> \
                                    <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;How many months into the &quot;</span> \
                                                 <span class="s">&quot;pregnancy?&quot;</span><span class="p">))</span>
    <span class="n">anc_visits</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;ANC Visits&quot;</span><span class="p">),</span> \
                                    <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of antenatal clinic &quot;</span>\
                                                 <span class="s">&quot;visits during pregnancy&quot;</span><span class="p">))</span>
    <span class="n">weeks_since_anc</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span>\
                                        <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Weeks since last ANC visit&quot;</span><span class="p">),</span> \
                                        <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;How many weeks since the patient&#39;s &quot;</span>\
                                         <span class="s">&quot;last ANC visit (0 for less &quot;</span> \
                                         <span class="s">&quot;than 7 days)?&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">, </span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;pregnancy_month&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_month</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;anc_visits&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">anc_visits</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weeks_since_anc</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;, </span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;weeks_since_anc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">weeks_since_anc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">estimated_dd</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">encounter</span><span class="o">.</span><span class="n">encounter_date</span> <span class="o">+</span> \
            <span class="n">timedelta</span><span class="p">(</span><span class="mf">30.3475</span> <span class="o">*</span> <span class="p">(</span><span class="mi">9</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_month</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">igive</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;month_of_current_gestation&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pregnancy_month</span><span class="p">,</span>
            <span class="s">&#39;antenatal_visit_number&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">anc_visits</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weeks_since_anc</span><span class="p">:</span>
            <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;weeks_since_last_anc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">weeks_since_anc</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">igive</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">PregnancyReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="SPregnancy"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.SPregnancy">[docs]</a><span class="k">class</span> <span class="nc">SPregnancy</span><span class="p">(</span><span class="n">PregnancyReport</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;SauriPregnancyReport added extra fields specific to Sauri&#39;&#39;&#39;</span>
    <span class="c">#shortened the name because of http://code.djangoproject.com/ticket/1820</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_sauri_pregrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Sauri Pregnancy Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Sauri Pregnancy Reports&quot;</span><span class="p">)</span>

    <span class="n">IRON_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">IRON_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">IRON_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">IRON_DOESNOTHAVE</span> <span class="o">=</span> <span class="s">&#39;X&#39;</span>
    <span class="n">IRON_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
                       <span class="p">(</span><span class="n">IRON_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Yes&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">IRON_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;No&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">IRON_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Unkown&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">IRON_DOESNOTHAVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Does not have&#39;</span><span class="p">)))</span>

    <span class="n">FOLIC_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">FOLIC_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">FOLIC_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">FOLIC_DOESNOTHAVE</span> <span class="o">=</span> <span class="s">&#39;X&#39;</span>
    <span class="n">FOLIC_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
                       <span class="p">(</span><span class="n">FOLIC_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Yes&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">FOLIC_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;No&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">FOLIC_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Unkown&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">FOLIC_DOESNOTHAVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Does not have&#39;</span><span class="p">)))</span>

    <span class="n">TESTED_YESREACTIVE</span> <span class="o">=</span> <span class="s">&#39;YR&#39;</span>
    <span class="n">TESTED_NOREACTIVE</span> <span class="o">=</span> <span class="s">&#39;NR&#39;</span>
    <span class="n">TESTED_NOUNKNOWN</span> <span class="o">=</span> <span class="s">&#39;NU&#39;</span>
    <span class="n">TESTED_YESNOTREACTIVE</span> <span class="o">=</span> <span class="s">&#39;YN&#39;</span>
    <span class="n">TESTED_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
                       <span class="p">(</span><span class="n">TESTED_YESREACTIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Yes Reactive&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">TESTED_NOREACTIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;No Reactive&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">TESTED_NOUNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;No Status Unknown&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">TESTED_YESNOTREACTIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Yes Not Reactive&#39;</span><span class="p">)))</span>

    <span class="n">CD4_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">CD4_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">CD4_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">CD4_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">CD4_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Yes&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">CD4_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">CD4_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unkown&quot;</span><span class="p">)))</span>

    <span class="n">iron_supplement</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Taking Iron supplements&quot;</span><span class="p">),</span> \
                            <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">IRON_CHOICES</span><span class="p">,</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Is the mother taking iron &quot;</span>\
                                            <span class="s">&quot;supplement?&quot;</span><span class="p">))</span>

    <span class="n">folic_suppliment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Taking Folic Acid supplements&quot;</span><span class="p">),</span> \
                            <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">FOLIC_CHOICES</span><span class="p">,</span>\
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Is the mother taking folic acid &quot;</span>\
                                            <span class="s">&quot;supplement?&quot;</span><span class="p">))</span>

    <span class="n">tested_hiv</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Tested for HIV&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> \
                                   <span class="n">choices</span><span class="o">=</span><span class="n">TESTED_CHOICES</span><span class="p">,</span> \
                              <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Did the mother get tested for &quot;</span>\
                                            <span class="s">&quot;HIV?&quot;</span><span class="p">))</span>

    <span class="n">cd4_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Completed CD4 Count&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                                   <span class="n">choices</span><span class="o">=</span><span class="n">CD4_CHOICES</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>\
                                   <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Was CD4 count taken?&quot;</span><span class="p">))</span>

    <span class="n">pmtc_arv</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;CodedItem&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                                    <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;PMTC ARV&quot;</span><span class="p">))</span>
</div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">SPregnancy</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="BCPillReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.BCPillReport">[docs]</a><span class="k">class</span> <span class="nc">BCPillReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_bcprpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Birth Control Pill Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Birth Control Pill Reports&quot;</span><span class="p">)</span>

    <span class="n">pills</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Pills given&quot;</span><span class="p">),</span> \
                                             <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">women</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Women given BC pills&quot;</span><span class="p">),</span>
                                             <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pills</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">pills</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unkown&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pills</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pills</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">women</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">women</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unkown&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">women</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">women</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;pills&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
              <span class="n">pills</span><span class="p">,</span> \
              <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;women&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
              <span class="n">women</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;number_of_women_given_bc_pills&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">women</span><span class="p">}</span>
</div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">BCPillReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="NeonatalReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.NeonatalReport">[docs]</a><span class="k">class</span> <span class="nc">NeonatalReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_neorpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Neonatal Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Neonatal Reports&quot;</span><span class="p">)</span>

    <span class="n">clinic_visits</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Clinic Visits&quot;</span><span class="p">),</span> \
                                    <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of clinic visits &quot;</span> \
                                                 <span class="s">&quot;since birth&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;clinic_visits&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
              <span class="bp">self</span><span class="o">.</span><span class="n">clinic_visits</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;number_of_health_facility_visits_since_birth&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">clinic_visits</span><span class="p">}</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">NeonatalReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="UnderOneReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.UnderOneReport">[docs]</a><span class="k">class</span> <span class="nc">UnderOneReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_uonerpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Under One Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Under One Reports&quot;</span><span class="p">)</span>

    <span class="n">BREAST_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">BREAST_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">BREAST_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">BREAST_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">BREAST_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Yes&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">BREAST_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">BREAST_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unknown&quot;</span><span class="p">)))</span>

    <span class="n">IMMUNIZED_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">IMMUNIZED_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">IMMUNIZED_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">IMMUNIZED_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">IMMUNIZED_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Yes&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">IMMUNIZED_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">IMMUNIZED_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unkown&quot;</span><span class="p">)))</span>

    <span class="n">breast_only</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Breast feeding exclusively&quot;</span><span class="p">),</span> \
                                   <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">BREAST_CHOICES</span><span class="p">,</span> \
                                   <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Does the mother &quot;</span> \
                                               <span class="s">&quot;exclusively breast feed?&quot;</span><span class="p">))</span>

    <span class="n">immunized</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Immunized&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                                   <span class="n">choices</span><span class="o">=</span><span class="n">IMMUNIZED_CHOICES</span><span class="p">,</span> \
                                   <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Is the child up-to-date on&quot;</span> \
                                                <span class="s">&quot;immunizations?&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;breast_only&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">get_breast_only_display</span><span class="p">(),</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;immunized&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">get_immunized_display</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">breast_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BREAST_YES</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">YES</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BREAST_NO</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">NO</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">BREAST_UNKNOWN</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">}</span>

        <span class="n">immun_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IMMUNIZED_YES</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">YES</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IMMUNIZED_NO</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">NO</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IMMUNIZED_UNKNOWN</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;breastfed_exclusively&#39;</span><span class="p">:</span> <span class="n">breast_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">breast_only</span><span class="p">],</span>
            <span class="s">&#39;immunizations_up_to_date&#39;</span><span class="p">:</span> <span class="n">immun_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">immunized</span><span class="p">]}</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">UnderOneReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="SUnderOne"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.SUnderOne">[docs]</a><span class="k">class</span> <span class="nc">SUnderOne</span><span class="p">(</span><span class="n">UnderOneReport</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;Sauri under one report with the extra field for vaccine&#39;&#39;&#39;</span>
    <span class="c">#shortened the name because of http://code.djangoproject.com/ticket/1820</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_sauri_uonerpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Sauri Under One Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Sauri Under One Reports&quot;</span><span class="p">)</span>

    <span class="n">vaccine</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Vaccine</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Vaccine&quot;</span><span class="p">))</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">SUnderOne</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="NutritionReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.NutritionReport">[docs]</a><span class="k">class</span> <span class="nc">NutritionReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;record nutrition related measurements&#39;&#39;&#39;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_nutrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Nutrition Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Nutrition Reports&quot;</span><span class="p">)</span>

    <span class="n">STATUS_MODERATE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">STATUS_SEVERE</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">STATUS_SEVERE_COMP</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">STATUS_HEALTHY</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="n">STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">STATUS_MODERATE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;MAM&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">STATUS_SEVERE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;SAM&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">STATUS_SEVERE_COMP</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;SAM+&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">STATUS_HEALTHY</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Healthy&quot;</span><span class="p">)))</span>

    <span class="n">OEDEMA_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">OEDEMA_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">OEDEMA_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">OEDEMA_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">OEDEMA_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Yes&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">OEDEMA_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">OEDEMA_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unknown&quot;</span><span class="p">)))</span>

    <span class="n">muac</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;MUAC (mm)&quot;</span><span class="p">),</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">oedema</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Oedema&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                              <span class="n">choices</span><span class="o">=</span><span class="n">OEDEMA_CHOICES</span><span class="p">)</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Weight (kg)&quot;</span><span class="p">),</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Status&quot;</span><span class="p">),</span>\
                                 <span class="n">choices</span><span class="o">=</span><span class="n">STATUS_CHOICES</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<div class="viewcode-block" id="NutritionReport.diagnose"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.NutritionReport.diagnose">[docs]</a>    <span class="k">def</span> <span class="nf">diagnose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Diagnosis of the patient&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATUS_HEALTHY</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">muac</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">muac</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">oedema</span> <span class="o">==</span> <span class="s">&#39;Y&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">muac</span> <span class="o">&lt;</span> <span class="mi">110</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATUS_SEVERE</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">muac</span> <span class="o">&lt;</span> <span class="mi">125</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATUS_MODERATE</span>
        <span class="k">print</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">muac</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">oedema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnose</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">NutritionReport</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">muac</span><span class="p">:</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;muac&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">muac</span><span class="p">))</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;oedema&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">get_oedema_display</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">:</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;weight&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">:</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;status&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">get_status_display</span><span class="p">()))</span>
        <span class="k">return</span> <span class="s">u&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">verbose_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STATUS_CHOICES</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">oedema_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OEDEMA_YES</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">YES</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OEDEMA_NO</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">NO</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OEDEMA_UNKNOWN</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">UNKNOWN</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">igive</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;mid_upper_arm_circumference&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">muac</span><span class="p">,</span>
            <span class="s">&#39;oedema&#39;</span><span class="p">:</span> <span class="n">oedema_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">oedema</span><span class="p">]}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">:</span>
            <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;weight&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">})</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oedema</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">OEDEMA_YES</span><span class="p">:</span>
            <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;reasons_for_referral__oedema&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">igive</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">NutritionReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="FeverReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.FeverReport">[docs]</a><span class="k">class</span> <span class="nc">FeverReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_fevrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Fever Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Fever Reports&quot;</span><span class="p">)</span>

    <span class="n">RDT_POSITIVE</span> <span class="o">=</span> <span class="s">&#39;P&#39;</span>
    <span class="n">RDT_NEGATIVE</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">RDT_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>

    <span class="n">RDT_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">RDT_POSITIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Positive&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">RDT_NEGATIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Negative&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">RDT_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unknown&quot;</span><span class="p">)))</span>

    <span class="n">rdt_result</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;RDT Result&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                                  <span class="n">choices</span><span class="o">=</span><span class="n">RDT_CHOICES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;rdt_result&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">get_rdt_result_display</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">rdt_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RDT_POSITIVE</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">POSITIVE</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RDT_NEGATIVE</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">NEGATIVE</span><span class="p">,</span>
            <span class="c"># HERE. mapped UNKNOWN as INDETERMINATE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">RDT_UNKNOWN</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">INDETERMINATE</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;rapid_test_for_malaria&#39;</span><span class="p">:</span> <span class="n">rdt_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rdt_result</span><span class="p">]}</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">FeverReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="MedicineGivenReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.MedicineGivenReport">[docs]</a><span class="k">class</span> <span class="nc">MedicineGivenReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_medsrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Medicine Given Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Medicine Given Reports&quot;</span><span class="p">)</span>

    <span class="n">medicines</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s">&#39;CodedItem&#39;</span><span class="p">,</span> \
                                         <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Medicines&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;medicines&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="s">u&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">ds</span><span class="o">.</span><span class="n">description</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">medicines</span><span class="o">.</span><span class="n">all</span><span class="p">()]))</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">igive</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">med</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">medicines</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">med</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;ACT&#39;</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">MEDIC_ORDER_ANTIMALARIAL</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">med</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;R&#39;</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">MEDIC_ORDER_ORS</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">med</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Z&#39;</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">MEDIC_ORDER_ZINC</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;current_medication_order&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">igive</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">MedicineGivenReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="ReferralReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.ReferralReport">[docs]</a><span class="k">class</span> <span class="nc">ReferralReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_refrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Referral Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Referral Reports&quot;</span><span class="p">)</span>

    <span class="n">URGENCY_AMBULANCE</span> <span class="o">=</span> <span class="s">&#39;A&#39;</span>
    <span class="n">URGENCY_EMERGENCY</span> <span class="o">=</span> <span class="s">&#39;E&#39;</span>
    <span class="n">URGENCY_BASIC</span> <span class="o">=</span> <span class="s">&#39;B&#39;</span>
    <span class="n">URGENCY_CONVENIENT</span> <span class="o">=</span> <span class="s">&#39;C&#39;</span>
    <span class="n">URGENCY_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
                       <span class="p">(</span><span class="n">URGENCY_AMBULANCE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Ambulance Referral&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">URGENCY_EMERGENCY</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Emergency Referral&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">URGENCY_BASIC</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Basic Referral&#39;</span><span class="p">)),</span>
                       <span class="p">(</span><span class="n">URGENCY_CONVENIENT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;Convenient Referral&#39;</span><span class="p">)))</span>

    <span class="n">urgency</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Urgency&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                               <span class="n">choices</span><span class="o">=</span><span class="n">URGENCY_CHOICES</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">verbose_urgency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">URGENCY_CHOICES</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">urgency</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;urgency&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">get_urgency_display</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">prio_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">URGENCY_AMBULANCE</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">REFERRAL_AMBULANCE</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">URGENCY_EMERGENCY</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">REFERRAL_EMERGENCY</span><span class="p">,</span>
            <span class="c"># HERE. mapped BASIC as URGENT.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">URGENCY_BASIC</span><span class="p">:</span> <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">REFERRAL_URGENT</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">URGENCY_CONVENIENT</span><span class="p">:</span> \
                              <span class="n">OpenMRSConsultationForm</span><span class="o">.</span><span class="n">REFERRAL_WHEN_CONVENIENT</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;referral_priority&#39;</span><span class="p">:</span> <span class="n">prio_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">urgency</span><span class="p">]}</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ReferralReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="HouseholdVisitReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.HouseholdVisitReport">[docs]</a><span class="k">class</span> <span class="nc">HouseholdVisitReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_hhvisitrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Household Visit Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Household Visit Reports&quot;</span><span class="p">)</span>

    <span class="n">available</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;HH Member Available&quot;</span><span class="p">),</span> \
                                <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Was a houshold member &quot;</span> \
                                             <span class="s">&quot;available?&quot;</span><span class="p">))</span>

    <span class="n">children</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Children Under Five&quot;</span><span class="p">),</span> \
                                        <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Number of children under 5 seen&quot;</span><span class="p">))</span>

    <span class="n">counseling</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="s">&#39;CodedItem&#39;</span><span class="p">,</span> \
                       <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Counseling / advice topics covered&quot;</span><span class="p">),</span> \
                       <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;available&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                 <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">available</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">available</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;, </span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;children&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">available</span><span class="p">:</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">OpenMRSHouseholdForm</span><span class="o">.</span><span class="n">YES</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avail</span> <span class="o">=</span> <span class="n">OpenMRSHouseholdForm</span><span class="o">.</span><span class="n">NO</span>
        <span class="n">igive</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;hh_member_available&#39;</span><span class="p">:</span> <span class="n">avail</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;number_children_under_five&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">counseling</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">ct</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;NUT&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;counseling_topics__nutrition&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">ct</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;FP&#39;</span><span class="p">,</span> <span class="s">&#39;BP&#39;</span><span class="p">):</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;counseling_topics__family_planning&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">ct</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;SH&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;counseling_topics__sanitation_and_hygiene&#39;</span><span class="p">:</span> \
                            <span class="bp">True</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">ct</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;BF&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;counseling_topics__breastfeeding&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">ct</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;BN&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;counseling_topics__bednet&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">ct</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;IM&#39;</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;counseling_topics__immunizations&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">igive</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;counseling_topics__other_non_coded&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">igive</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">HouseholdVisitReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="FamilyPlanningReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.FamilyPlanningReport">[docs]</a><span class="k">class</span> <span class="nc">FamilyPlanningReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_fprpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Family Planning Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Family Planning Reports&quot;</span><span class="p">)</span>

    <span class="n">women</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Women&quot;</span><span class="p">),</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of women aged 15 to 49 &quot;</span> \
                                         <span class="s">&quot;seen during visit&quot;</span><span class="p">))</span>

    <span class="n">women_using</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Women using FP&quot;</span><span class="p">),</span> \
                                                <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of the women using &quot;</span> \
                                         <span class="s">&quot;modern family planning&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;women&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                     <span class="bp">self</span><span class="o">.</span><span class="n">women</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">women_using</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;, </span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span>\
                                            <span class="s">&#39;women_using&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
                                   <span class="bp">self</span><span class="o">.</span><span class="n">women_using</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">familyplanningusage_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot; (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> \
                            <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">unicode</span><span class="p">(</span><span class="n">fpu</span><span class="p">)</span> <span class="k">for</span> <span class="n">fpu</span> <span class="ow">in</span> \
                                        <span class="bp">self</span><span class="o">.</span><span class="n">familyplanningusage_set</span><span class="o">.</span><span class="n">all</span><span class="p">()])</span>
        <span class="k">return</span> <span class="n">string</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;women_seen&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">women</span><span class="p">,</span>
            <span class="s">&#39;women_using_family_planning&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">women_using</span><span class="p">,</span>
        <span class="p">}</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">FamilyPlanningReport</span><span class="p">,</span> \
                   <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">,</span> <span class="s">&#39;familyplanningusage_set&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="SickMembersReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.SickMembersReport">[docs]</a><span class="k">class</span> <span class="nc">SickMembersReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_sickrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Sick Household Members Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Sick Household Members Reports&quot;</span><span class="p">)</span>

    <span class="n">sick</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Others sick&quot;</span><span class="p">),</span> \
                           <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of other sick household &quot;</span> \
                                        <span class="s">&quot;members seen during visit&quot;</span><span class="p">))</span>

    <span class="n">rdts</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;RDTs&quot;</span><span class="p">),</span> \
                           <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of RDTs used on other &quot;</span> \
                                        <span class="s">&quot;sick household members&quot;</span><span class="p">))</span>

    <span class="n">positive_rdts</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Positive RDTs&quot;</span><span class="p">),</span> \
                           <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of positve RDTs cases for &quot;</span> \
                                        <span class="s">&quot;other sick household members&quot;</span><span class="p">))</span>

    <span class="n">on_treatment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Others on treatment&quot;</span><span class="p">),</span>\
                           <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of other sick household &quot;</span> \
                                        <span class="s">&quot;members receiving anti-malarial &quot;</span> \
                                        <span class="s">&quot;treatment&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">, </span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">, </span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">, </span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;sick&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">sick</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;rdts&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">rdts</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;positive_rdts&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">positive_rdts</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;on_treatment&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">on_treatment</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;other_sick_members&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sick</span><span class="p">,</span>
            <span class="s">&#39;rdts_used&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rdts</span><span class="p">,</span>
            <span class="s">&#39;positive_rdts&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_rdts</span><span class="p">,</span>
            <span class="s">&#39;other_sick_members_on_treatment&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_treatment</span><span class="p">,</span>
        <span class="p">}</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">SickMembersReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="VerbalAutopsyReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.VerbalAutopsyReport">[docs]</a><span class="k">class</span> <span class="nc">VerbalAutopsyReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_autopsyrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Verbal Autopsy Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Verbal Autopsy Reports&quot;</span><span class="p">)</span>

    <span class="n">done</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Completed?&quot;</span><span class="p">),</span> \
                                <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Was a Verbal Autopsy conducted?&#39;</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="BedNetReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.BedNetReport">[docs]</a><span class="k">class</span> <span class="nc">BedNetReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_bnrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Bednet Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Bednet Reports&quot;</span><span class="p">)</span>

    <span class="n">sleeping_sites</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Sleeping sites&quot;</span><span class="p">),</span>\
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of sleeping sites&quot;</span><span class="p">))</span>

    <span class="n">function_nets</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Recent Bednets&quot;</span><span class="p">),</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of functioning bednets&quot;</span><span class="p">))</span>
    <span class="n">earlier_nets</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Earlier Bednets&quot;</span><span class="p">),</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of bednets received&quot;</span> \
                            <span class="s">&quot; earlier &quot;</span><span class="p">))</span>
    <span class="n">damaged_nets</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Damaged Bednets&quot;</span><span class="p">),</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of recent bednets that are&quot;</span> \
                                        <span class="s">&quot; damaged&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">, </span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;sleeping_sites&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">sleeping_sites</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;function_nets&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">nets</span><span class="p">)</span>
</div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">BedNetReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="ExtendedBedNetReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.ExtendedBedNetReport">[docs]</a><span class="k">class</span> <span class="nc">ExtendedBedNetReport</span><span class="p">(</span><span class="n">BedNetReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_ebnrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Extended Bednet Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Extended Bednet Reports&quot;</span><span class="p">)</span>

    <span class="n">people</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of people&quot;</span><span class="p">),</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of people who are &quot;</span> \
                                        <span class="s">&quot;sleeping in the household&quot;</span><span class="p">))</span>
</div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">ExtendedBedNetReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>

<div class="viewcode-block" id="BednetUtilization"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.BednetUtilization">[docs]</a><span class="k">class</span> <span class="nc">BednetUtilization</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_bdnutil_rpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Bednet utilization Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Bednet utilization reports&quot;</span><span class="p">)</span>

    <span class="n">DONT_HAVE</span> <span class="o">=</span> <span class="s">&#39;NH&#39;</span>
    <span class="n">BEDNET_DAMAGED</span> <span class="o">=</span> <span class="s">&#39;BD&#39;</span>
    <span class="n">DIFFICULT_HUNG</span> <span class="o">=</span> <span class="s">&#39;DH&#39;</span>
    <span class="n">SMALL_ROOM</span> <span class="o">=</span> <span class="s">&#39;SR&#39;</span>
    <span class="n">DIFFICULT_BREATHE</span> <span class="o">=</span> <span class="s">&#39;DB&#39;</span>
    <span class="n">NOT_EFFECTIVE</span> <span class="o">=</span> <span class="s">&#39;NE&#39;</span>
    <span class="n">OTHER</span> <span class="o">=</span> <span class="s">&#39;Z&#39;</span>
    <span class="n">UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">U</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">REASON_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">DIFFICULT_BREATHE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Difficulty to breathe&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">NOT_EFFECTIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Doubt about effectiveness&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">SMALL_ROOM</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Room too small&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">DIFFICULT_HUNG</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Difficulty to hang&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">BEDNET_DAMAGED</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Bednet damaged&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">DONT_HAVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;No bednet&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Unknown&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">OTHER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Other&#39;</span><span class="p">)))</span>

    <span class="n">child_underfive</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;children under&quot;</span> \
                            <span class="s">&quot; five &quot;</span><span class="p">),</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of children &quot;</span> \
                            <span class="s">&quot;under five who slept here last night.&quot;</span><span class="p">))</span>
    <span class="n">child_lastnite</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Children slept &quot;</span> \
                            <span class="s">&quot;under bednet&quot;</span><span class="p">),</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of children&quot;</span> \
                            <span class="s">&quot; under five who slept under bednet last night.&quot;</span><span class="p">))</span>
    <span class="n">hanging_bednet</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of hanging bednet&quot;</span><span class="p">),</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Number of hanging bednet&quot;</span><span class="p">))</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Reason &quot;</span><span class="p">),</span> \
                            <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;reason why some children didn&#39;t&quot;</span> \
                            <span class="s">&quot; sleep under bednet&quot;</span><span class="p">),</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                            <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">REASON_CHOICES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">, </span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;child_underfive&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">child_underfive</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;child_lastnite&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">child_lastnite</span><span class="p">)</span>
</div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">BednetUtilization</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="SanitationReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.SanitationReport">[docs]</a><span class="k">class</span> <span class="nc">SanitationReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_sanitation_rpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Sanitation Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Sanitation Reports&quot;</span><span class="p">)</span>

    <span class="n">FLUSH</span> <span class="o">=</span> <span class="s">&#39;FL&#39;</span>
    <span class="n">VENTILATED_IMPROVED_PIT</span> <span class="o">=</span> <span class="s">&#39;VP&#39;</span>
    <span class="n">PITLAT_WITH_SLAB</span> <span class="o">=</span> <span class="s">&#39;PY&#39;</span>
    <span class="n">PITLAT_WITHOUT_SLAB</span> <span class="o">=</span> <span class="s">&#39;PN&#39;</span>
    <span class="n">COMPOSTING_TOILET</span> <span class="o">=</span> <span class="s">&#39;CT&#39;</span>
    <span class="n">BUCKET</span> <span class="o">=</span> <span class="s">&#39;BT&#39;</span>
    <span class="n">HANGING_TOILET_LAT</span> <span class="o">=</span> <span class="s">&#39;HT&#39;</span>
    <span class="n">NO_FACILITY_OR_BUSH</span> <span class="o">=</span> <span class="s">&#39;NS&#39;</span>
    <span class="n">OTHER</span> <span class="o">=</span> <span class="s">&#39;Z&#39;</span>

    <span class="n">TOILET_LAT_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">FLUSH</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Flush&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">VENTILATED_IMPROVED_PIT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Ventilated Improved Pit Latrine&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">PITLAT_WITH_SLAB</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Pit Latrine with slab&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">PITLAT_WITHOUT_SLAB</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Pit Latrine without slab&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">COMPOSTING_TOILET</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Compositing Pit Toilet&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">BUCKET</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Bucket&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">HANGING_TOILET_LAT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Hanging Toilet Latrine&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">NO_FACILITY_OR_BUSH</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;No facility&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">OTHER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Other&#39;</span><span class="p">)))</span>

    <span class="n">PB</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
    <span class="n">U</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">toilet_lat</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Toilet Type&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> \
                              <span class="n">choices</span><span class="o">=</span><span class="n">TOILET_LAT_CHOICES</span><span class="p">)</span>
    <span class="n">share_toilet</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;How many shares?&quot;</span><span class="p">),</span> \
                                <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;How many people&quot;</span> \
                                <span class="s">&quot; share the toilet (open to public = -1, &quot;</span> \
                                <span class="s">&quot;unknown = -2 )&quot;</span><span class="p">))</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">SanitationReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="DrinkingWaterReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.DrinkingWaterReport">[docs]</a><span class="k">class</span> <span class="nc">DrinkingWaterReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_drnkwater_rpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Drinking Water Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Drinking Water Reports&quot;</span><span class="p">)</span>

    <span class="n">PIPED_WATER</span> <span class="o">=</span> <span class="s">&#39;PP&#39;</span>
    <span class="n">PUBLIC_TAP_STANDPIPE</span> <span class="o">=</span> <span class="s">&#39;PT&#39;</span>
    <span class="n">TUBEWELL_BOREHOLE</span> <span class="o">=</span> <span class="s">&#39;TB&#39;</span>
    <span class="n">PROTECTED_DUG_WELL</span> <span class="o">=</span> <span class="s">&#39;PW&#39;</span>
    <span class="n">UNPROTECTED_DUG_WELL</span> <span class="o">=</span> <span class="s">&#39;UW&#39;</span>
    <span class="n">PROTECTED_SPRING</span> <span class="o">=</span> <span class="s">&#39;PS&#39;</span>
    <span class="n">UNPROTECTED_SPRING</span> <span class="o">=</span> <span class="s">&#39;UP&#39;</span>
    <span class="n">RAIN_COLLECTION</span> <span class="o">=</span> <span class="s">&#39;RW&#39;</span>
    <span class="n">SURFACE_WATER</span> <span class="o">=</span> <span class="s">&#39;SU&#39;</span>
    <span class="n">OTHER</span> <span class="o">=</span> <span class="s">&#39;Z&#39;</span>

    <span class="n">DRNKWATER_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">PIPED_WATER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Piped water into dwelling or yard/plot&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">PUBLIC_TAP_STANDPIPE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Public Tap/Standpipe&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">TUBEWELL_BOREHOLE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Tube well / Borehole&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">PROTECTED_DUG_WELL</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Protected dug well&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">UNPROTECTED_DUG_WELL</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Unprotected Dug well&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">PROTECTED_SPRING</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Protected Spring&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">UNPROTECTED_SPRING</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Unprotected spring&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">RAIN_COLLECTION</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Rain water collection&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">SURFACE_WATER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Surface water (river, dam, lake, pond, stream&#39;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">OTHER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&#39;Other&#39;</span><span class="p">)))</span>

    <span class="n">TREATMENT_METHOD_BOIL</span> <span class="o">=</span> <span class="s">&#39;BW&#39;</span>
    <span class="n">TREATMENT_METHOD_DONATED_CHLORINE</span> <span class="o">=</span> <span class="s">&#39;DC&#39;</span>
    <span class="n">TREATMENT_METHOD_BOUGHT_CHLORINE</span> <span class="o">=</span> <span class="s">&#39;BC&#39;</span>
    <span class="n">TREATMENT_METHOD_CLOTH</span> <span class="o">=</span> <span class="s">&#39;SC&#39;</span>
    <span class="n">TREATMENT_METHOD_WATERFILTER</span> <span class="o">=</span> <span class="s">&#39;WF&#39;</span>
    <span class="n">TREATMENT_METHOD_SOLARDISINFECTION</span> <span class="o">=</span> <span class="s">&#39;SR&#39;</span>
    <span class="n">TREATMENT_METHOD_STAND_SETTLE</span> <span class="o">=</span> <span class="s">&#39;LS&#39;</span>
    <span class="n">TREATMENT_METHOD_OTHER</span> <span class="o">=</span> <span class="s">&#39;Z&#39;</span>
    <span class="n">TREATMENT_METHOD_DONTKNOW</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">TREATMENT_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">TREATMENT_METHOD_BOIL</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Boil water&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">TREATMENT_METHOD_DONATED_CHLORINE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Donated bleach/chlorine&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">TREATMENT_METHOD_BOUGHT_CHLORINE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Bought bleach/chlorine&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">TREATMENT_METHOD_CLOTH</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Strain it through cloth&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">TREATMENT_METHOD_WATERFILTER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Use water filter: sand/ceramic&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">TREATMENT_METHOD_SOLARDISINFECTION</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Solar disinfection&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">TREATMENT_METHOD_STAND_SETTLE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Let it stand and settle&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">TREATMENT_METHOD_OTHER</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Other&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">TREATMENT_METHOD_DONTKNOW</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unknown&quot;</span><span class="p">)),)</span>

    <span class="n">water_source</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Water Source&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> \
                              <span class="n">choices</span><span class="o">=</span><span class="n">DRNKWATER_CHOICES</span><span class="p">)</span>
    <span class="n">treatment_method</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Treatment method&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> \
                              <span class="n">choices</span><span class="o">=</span><span class="n">TREATMENT_CHOICES</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;What &quot;</span> \
                                <span class="s">&quot;do you use to make it safer to drink&quot;</span><span class="p">),</span> \
                                <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">DrinkingWaterReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="BednetIssuedReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.BednetIssuedReport">[docs]</a><span class="k">class</span> <span class="nc">BednetIssuedReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_bdnstc_rpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Bednet Distribution Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Betnet Distribution Reports&quot;</span><span class="p">)</span>

    <span class="n">bednet_received</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Bed net received&quot;</span><span class="p">))</span>
</div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">BednetIssuedReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="AntenatalVisitReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.AntenatalVisitReport">[docs]</a><span class="k">class</span> <span class="nc">AntenatalVisitReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_iavrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Initial Antenatal Visit Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Initial Antenatal Visit Reports&quot;</span><span class="p">)</span>

    <span class="n">expected_on</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Expected Date of Delivery&quot;</span><span class="p">))</span>
    <span class="n">sms_alert</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">SmsAlertModel</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;expected_on&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
             <span class="bp">self</span><span class="o">.</span><span class="n">expected_on</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">AntenatalVisitReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="AppointmentReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.AppointmentReport">[docs]</a><span class="k">class</span> <span class="nc">AppointmentReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_appointment&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Appointment&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Appointments&quot;</span><span class="p">)</span>

    <span class="n">STATUS_OPEN</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">STATUS_CLOSED</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">STATUS_PENDING_CV</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">STATUS_OPEN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Open&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">STATUS_CLOSED</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Closed&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">STATUS_PENDING_CV</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Pending Clinic Visit&quot;</span><span class="p">)))</span>

    <span class="n">appointment_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Next appointment&quot;</span><span class="p">))</span>
    <span class="n">closed_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Date closed&quot;</span><span class="p">),</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                                        <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Status&quot;</span><span class="p">),</span> \
                                                <span class="n">choices</span><span class="o">=</span><span class="n">STATUS_CHOICES</span><span class="p">,</span>
                                <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Is the appointment still open&quot;</span> \
                                            <span class="s">&quot; or closed?&quot;</span><span class="p">),</span> \
                                            <span class="n">default</span><span class="o">=</span><span class="n">STATUS_OPEN</span><span class="p">)</span>
    <span class="n">task_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s">&#39;Task ID&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> \
                                            <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">sms_alert</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">SmsAlertModel</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;appointment_date&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span>\
             <span class="bp">self</span><span class="o">.</span><span class="n">appointment_date</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>

<div class="viewcode-block" id="AppointmentReport.get_omrs_dict"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.AppointmentReport.get_omrs_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;OpenMRS Key/Value dict.</span>

<span class="sd">        Return key/value dictionary of openmrs values that this report can</span>
<span class="sd">        populate</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;return_visit_date&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">appointment_date</span><span class="p">}</span></div></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">AppointmentReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="PregnancyRegistrationReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.PregnancyRegistrationReport">[docs]</a><span class="k">class</span> <span class="nc">PregnancyRegistrationReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_pregregrpt&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Pregnancy Registration&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Pregnancy Registrations&quot;</span><span class="p">)</span>

    <span class="n">MARRIED_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">MARRIED_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">MARRIED_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">MARRIED_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">MARRIED_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Yes&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">MARRIED_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">MARRIED_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unknown&quot;</span><span class="p">)))</span>

    <span class="n">married</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Married?&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                                        <span class="n">choices</span><span class="o">=</span><span class="n">MARRIED_CHOICES</span><span class="p">)</span>
    <span class="n">pregnancies</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Number of Pregancies&quot;</span><span class="p">))</span>
    <span class="n">number_of_children</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveSmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Number of &quot;</span> \
                                                            <span class="s">&quot;Pregancies&quot;</span><span class="p">),</span> \
                                                            <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                        <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">husband</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;Patient&#39;</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> \
                                  <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Husband&quot;</span><span class="p">),</span> \
                                  <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;The husband to this pregnant&quot;</span>\
                                            <span class="s">&quot; woman&quot;</span><span class="p">),</span>\
                                  <span class="n">related_name</span><span class="o">=</span><span class="s">&#39;husband&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;married&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">married</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s">u&quot;, </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;pregnancies&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">pregnancies</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s">u&quot;, </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;number_of_children&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>\
                <span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_children</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>

<div class="viewcode-block" id="PregnancyRegistrationReport.get_omrs_dict"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.PregnancyRegistrationReport.get_omrs_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;OpenMRS Key/Value dict.</span>

<span class="sd">        Return key/value dictionary of openmrs values that this report can</span>
<span class="sd">        populate</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;total_offspring_living_in_home&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_children</span><span class="p">}</span></div></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">PregnancyRegistrationReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="HIVTestReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.HIVTestReport">[docs]</a><span class="k">class</span> <span class="nc">HIVTestReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_hivtest&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;HIV Test&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;HIV Tests&quot;</span><span class="p">)</span>

    <span class="n">HIV_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">HIV_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">HIV_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">HIV_NOCONSENT</span> <span class="o">=</span> <span class="s">&#39;NC&#39;</span>
    <span class="n">HIV_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">HIV_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Yes&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">HIV_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">HIV_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unknown&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">HIV_NOCONSENT</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No Consent&quot;</span><span class="p">)))</span>
    <span class="n">BLOOD_DRAWN_YES</span> <span class="o">=</span> <span class="s">&#39;Y&#39;</span>
    <span class="n">BLOOD_DRAWN_NO</span> <span class="o">=</span> <span class="s">&#39;N&#39;</span>
    <span class="n">BLOOD_DRAWN_UNKNOWN</span> <span class="o">=</span> <span class="s">&#39;U&#39;</span>
    <span class="n">BLOOD_DRAWN_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">BLOOD_DRAWN_YES</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Yes&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">BLOOD_DRAWN_NO</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">BLOOD_DRAWN_UNKNOWN</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Unknown&quot;</span><span class="p">)))</span>

    <span class="n">hiv</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;HIV+?&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> \
                              <span class="n">choices</span><span class="o">=</span><span class="n">HIV_CHOICES</span><span class="p">)</span>
    <span class="n">blood_drawn</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Blood drawn?&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> \
                                        <span class="n">choices</span><span class="o">=</span><span class="n">BLOOD_DRAWN_CHOICES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;hiv&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">hiv</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">+=</span> <span class="s">u&quot;, </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;blood_drawn&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">blood_drawn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>

<div class="viewcode-block" id="HIVTestReport.get_omrs_dict"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.HIVTestReport.get_omrs_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;OpenMRS Key/Value dict.</span>

<span class="sd">        Return key/value dictionary of openmrs values that this report can</span>
<span class="sd">        populate</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;blood_drawn_for_cd4_count&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">blood_drawn</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hiv</span> <span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">HIV_YES</span><span class="p">:</span>
            <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;hiv_test&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hiv</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">HIV_NO</span><span class="p">:</span>
            <span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;hiv_test&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">info</span></div></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">HIVTestReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="DBSResultReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.DBSResultReport">[docs]</a><span class="k">class</span> <span class="nc">DBSResultReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_dbsresult&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;DBS Result&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;DBS Results&quot;</span><span class="p">)</span>

    <span class="n">RESULT_POSITIVE</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">RESULT_NEGATIVE</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">RESULT_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">RESULT_POSITIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Yes&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">RESULT_NEGATIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;No&quot;</span><span class="p">)))</span>
    <span class="n">test_result</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Test Result&quot;</span><span class="p">),</span> \
                                        <span class="n">choices</span><span class="o">=</span><span class="n">RESULT_CHOICES</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;test_result&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">test_result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span>

<div class="viewcode-block" id="DBSResultReport.get_omrs_dict"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.DBSResultReport.get_omrs_dict">[docs]</a>    <span class="k">def</span> <span class="nf">get_omrs_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;OpenMRS Key/Value dict.</span>

<span class="sd">        Return key/value dictionary of openmrs values that this report can</span>
<span class="sd">        populate</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">&#39;hiv_infected&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_result</span><span class="p">}</span></div></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">DBSResultReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="CD4ResultReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.CD4ResultReport">[docs]</a><span class="k">class</span> <span class="nc">CD4ResultReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_cd4result&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;CD4 Result&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;CD4 Results&quot;</span><span class="p">)</span>

    <span class="n">cd4_count</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">PositiveIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;CD4 Count&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">u&quot;</span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> \
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">get_field_by_name</span><span class="p">(</span><span class="s">&#39;cd4_count&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">cd4_count</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">string</span></div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">CD4ResultReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>


<div class="viewcode-block" id="PatientStatusReport"><a class="viewcode-back" href="../../../api/apps/childcount/models/reports.html#childcount.models.reports.PatientStatusReport">[docs]</a><span class="k">class</span> <span class="nc">PatientStatusReport</span><span class="p">(</span><span class="n">CCReport</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">app_label</span> <span class="o">=</span> <span class="s">&#39;childcount&#39;</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s">&#39;cc_patientstatus&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Patient status Report&quot;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Patients status Report&quot;</span><span class="p">)</span>

    <span class="n">STATUS_ACTIVE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">STATUS_INACTIVE</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">STATUS_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">STATUS_ACTIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Alive&quot;</span><span class="p">)),</span>
        <span class="p">(</span><span class="n">STATUS_INACTIVE</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">u&quot;Relocated&quot;</span><span class="p">)))</span>

    <span class="n">status</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Status&quot;</span><span class="p">),</span> <span class="n">choices</span><span class="o">=</span><span class="n">STATUS_CHOICES</span><span class="p">)</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">u&quot;Reason&quot;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</div>
<span class="n">reversion</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">PatientStatusReport</span><span class="p">,</span> <span class="n">follow</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ccreport_ptr&#39;</span><span class="p">])</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">ChildCount+ v2.0(g) documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Earth Institue and Millennium Villages Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>